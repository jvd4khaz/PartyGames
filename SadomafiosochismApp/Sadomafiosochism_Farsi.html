<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³Ø§Ø¯ÙˆÙ…Ø§ÙÛŒØ§Ø³ÙˆØ®ÛŒØ³Ù…</title>
    <style>
        :root {
            --bg-color: #0f172a; /* Navy Blue */
            --card-bg: #1e293b;
            --text-primary: #FFFFFF;
            --text-secondary: #94a3b8;
            --accent-color: #f59e0b; /* Amber for Jester */
            --mafia-color: #ef4444;
            --town-color: #22c55e;
            --jester-color: #f59e0b;
            --ic-color: #3b82f6;
            --border-radius: 16px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Tahoma', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }

        .container {
            width: 95%;
            max-width: 500px;
            padding: 24px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        h1 { font-size: 1.8rem; margin: 0 0 0.5rem 0; font-weight: 900; color: var(--accent-color); }
        p { font-size: 1rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6; }

        .setup-info {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            width: 100%;
            text-align: right;
            font-size: 0.9rem;
            color: #ddd;
        }

        .role-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin: 2px;
        }
        
        .bg-mafia { background-color: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .bg-town { background-color: rgba(34, 197, 94, 0.2); color: #86efac; }
        .bg-jester { background-color: rgba(245, 158, 11, 0.2); color: #fcd34d; }
        .bg-ic { background-color: rgba(59, 130, 246, 0.2); color: #93c5fd; }

        /* Bottom Bar */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #1e293b;
            padding: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            border-top: 1px solid #334155;
            display: flex;
            justify-content: center;
            z-index: 100;
        }

        button.action-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-family: inherit;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            width: 100%;
            max-width: 400px;
        }

        /* Screens */
        .hidden { display: none !important; }
        
        .role-card {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 16px;
            width: 100%;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .role-title {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .private-info {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid #555;
            color: #ccc;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            font-weight: bold;
            font-size: 1rem;
        }

        .mafia-info {
            border-color: var(--mafia-color);
            background-color: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
        }

    </style>
</head>
<body>

    <!-- 1. Setup Screen -->
    <div id="setup-screen" class="container">
        <h1>Ø³Ø§Ø¯ÙˆÙ…Ø§ÙÛŒØ§Ø³ÙˆØ®ÛŒØ³Ù…</h1>
        <p>Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ûµ Ù†ÙØ±Ù‡ (Micro Setup)</p>

        <div class="setup-info">
            <strong>Ù†Ù‚Ø´â€ŒÙ‡Ø§ (Ûµ Ù†ÙØ±):</strong><br>
            â€¢ Û± <span class="role-badge bg-mafia">Ù…Ø§ÙÛŒØ§ Ú¯Ø§Ø¯ ÙØ§Ø¯Ø±</span><br>
            â€¢ Û± <span class="role-badge bg-jester">Ø¯Ù„Ù‚Ú© (Jester)</span><br>
            â€¢ Û± <span class="role-badge bg-ic">Ú©ÙˆØ¯Ú© Ù…Ø¹ØµÙˆÙ… (Innocent Child)</span><br>
            â€¢ Û² <span class="role-badge bg-town">Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø³Ø§Ø¯Ù‡</span>
        </div>

        <div class="setup-info">
            <strong>Ù‚ÙˆØ§Ù†ÛŒÙ† Ø®Ø§Øµ:</strong><br>
            â€¢ <strong>Ù…Ø§ÙÛŒØ§</strong> Ø¯Ù„Ù‚Ú© Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù†Ø§Ø³Ø¯ (Ø§Ù…Ø§ Ø¯Ù„Ù‚Ú© Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ù†Ù…ÛŒâ€ŒØ´Ù†Ø§Ø³Ø¯).<br>
            â€¢ <strong>Ú©ÙˆØ¯Ú© Ù…Ø¹ØµÙˆÙ…</strong> Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ØªÙˆØ³Ø· Ø±Ø§ÙˆÛŒ Ø¨Ù‡ Ù‡Ù…Ù‡ Ù…Ø¹Ø±ÙÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª).<br>
            â€¢ Ø§Ú¯Ø± Ø¯Ù„Ù‚Ú© Ø¯Ø± Ø±ÙˆØ² Ø§ÙˆÙ„ Ø§Ø¹Ø¯Ø§Ù… Ù†Ø´ÙˆØ¯ØŒ Ø´Ø¨ Ø§ÙˆÙ„ <strong>ØªÛŒØ±Ø§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø§ÙÛŒØ§ Ù„ØºÙˆ Ù…ÛŒâ€ŒØ´ÙˆØ¯</strong> (Skip Night 1).<br>
            â€¢ Ø¯Ù„Ù‚Ú© Ø§Ú¯Ø± Ø¯Ø± Ø±ÙˆØ² Ø§ÙˆÙ„ Ø§Ø¹Ø¯Ø§Ù… Ø´ÙˆØ¯ØŒ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø®ØµÛŒ Ø§Ø³Øª (Ø¨Ø§Ø²ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒÛŒØ§Ø¨Ø¯).
        </div>
    </div>

    <!-- Bottom Bar -->
    <div id="bottom-bar" class="bottom-bar">
        <button class="action-btn" onclick="startGame()">Ø´Ø±ÙˆØ¹ ØªÙˆØ²ÛŒØ¹ Ù†Ù‚Ø´</button>
    </div>

    <!-- 2. Pass Screen -->
    <div id="pass-screen" class="container hidden">
        <div style="font-size: 0.9rem; color: #888; margin-bottom: 20px;">
            Ø¨Ø§Ø²ÛŒÚ©Ù† <span id="player-num-pass">1</span> Ø§Ø² 5
        </div>
        <div style="font-size: 5rem; margin: 30px;">ğŸ“±</div>
        <h2>Ù†ÙˆØ¨Øª Ø¨Ø§Ø²ÛŒÚ©Ù† <span id="player-idx" style="color: var(--accent-color);">1</span></h2>
        <p>Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø¨Ù‡ Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø¯Ù‡ÛŒØ¯.</p>
        <button class="action-btn" style="margin-top: 20px; background-color: #334155;" onclick="revealRole()">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†Ù‚Ø´</button>
    </div>

    <!-- 3. Reveal Screen -->
    <div id="reveal-screen" class="container hidden">
        <div style="font-size: 0.9rem; color: #888;">
            Ø¨Ø§Ø²ÛŒÚ©Ù† <span id="player-num-reveal">1</span>
        </div>
        
        <div class="role-card">
            <div id="role-title" class="role-title">...</div>
            <div id="role-desc" style="color: #ccc; font-size: 0.95rem; line-height: 1.6;">...</div>
            
            <div id="mafia-intel" class="private-info mafia-info hidden">
                ğŸ¤¡ Ù‡ÙˆÛŒØª Ø¯Ù„Ù‚Ú©: Ø¨Ø§Ø²ÛŒÚ©Ù† Ø´Ù…Ø§Ø±Ù‡ X
            </div>
        </div>

        <p style="font-size: 0.9rem; opacity: 0.6; margin-top: 20px;">Ù†Ù‚Ø´ Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ø¨Ø³Ù¾Ø§Ø±ÛŒØ¯ Ùˆ Ù¾Ù†Ù‡Ø§Ù† Ú©Ù†ÛŒØ¯.</p>
        <button id="next-btn" class="action-btn" style="background-color: #444;" onclick="nextPlayer()">Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ùˆ Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ</button>
    </div>

    <!-- 4. End Screen -->
    <div id="end-screen" class="container hidden">
        <div style="font-size: 5rem; margin-bottom: 20px;">ğŸ­</div>
        <h1>Ù¾Ø§ÛŒØ§Ù† ØªÙˆØ²ÛŒØ¹</h1>
        <p>Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø¨Ù‡ Ø±Ø§ÙˆÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†ÛŒØ¯.</p>
        
        <div class="setup-info" style="text-align: center;">
            <h3 style="margin-top: 0; color: var(--ic-color);">Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø±Ø§ÙˆÛŒ</h3>
            <div id="ic-reveal" style="font-size: 1.1rem; font-weight: bold; color: var(--ic-color); margin-bottom: 15px;">
                Ú©ÙˆØ¯Ú© Ù…Ø¹ØµÙˆÙ…: Ø¨Ø§Ø²ÛŒÚ©Ù† X
            </div>
            <div style="font-size: 0.9rem; color: #ddd;">
                Ù„Ø·ÙØ§Ù‹ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ø±ÙˆØ² Ø§ÙˆÙ„ØŒ <strong>Ú©ÙˆØ¯Ú© Ù…Ø¹ØµÙˆÙ…</strong> Ø±Ø§ Ø¨Ù‡ Ù‡Ù…Ù‡ Ù…Ø¹Ø±ÙÛŒ Ú©Ù†ÛŒØ¯ (Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ù‚Ø·Ø¹ÛŒ).
            </div>
        </div>

        <button class="action-btn" style="margin-top: 20px; background-color: #ef4444;" onclick="restartGame()">Ø¨Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ (Restart)</button>
        <button class="action-btn" style="margin-top: 10px; background-color: #334155;" onclick="newSetup()">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯</button>
    </div>

    <script>
        // --- Game State ---
        var roles = [
            { id: 'mafia', name: 'Ù…Ø§ÙÛŒØ§', color: '#ef4444', desc: 'Ø´Ù…Ø§ Ù…Ø§ÙÛŒØ§ Ù‡Ø³ØªÛŒØ¯. Ø¯Ù„Ù‚Ú© Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù†Ø§Ø³ÛŒØ¯. Ø§Ú¯Ø± Ø¯Ù„Ù‚Ú© Ø±ÙˆØ² Ø§ÙˆÙ„ Ø§Ø¹Ø¯Ø§Ù… Ù†Ø´ÙˆØ¯ØŒ Ø§Ù…Ø´Ø¨ ØªÛŒØ± Ù†Ø¯Ø§Ø±ÛŒØ¯.' },
            { id: 'jester', name: 'Ø¯Ù„Ù‚Ú© (Jester)', color: '#f59e0b', desc: 'Ù‡Ø¯Ù Ø´Ù…Ø§: Ø¯Ø± Ø±ÙˆØ² Ø§ÙˆÙ„ Ø§Ø¹Ø¯Ø§Ù… Ø´ÙˆÛŒØ¯ ØªØ§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´ÙˆÛŒØ¯. Ø§Ú¯Ø± Ø²Ù†Ø¯Ù‡ Ø¨Ù…Ø§Ù†ÛŒØ¯ØŒ Ø´Ø¨ Ø§ÙˆÙ„ Ù„ØºÙˆ Ù…ÛŒâ€ŒØ´ÙˆØ¯.' },
            { id: 'ic', name: 'Ú©ÙˆØ¯Ú© Ù…Ø¹ØµÙˆÙ…', color: '#3b82f6', desc: 'Ø´Ù…Ø§ Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ù‡Ø³ØªÛŒØ¯. Ø±Ø§ÙˆÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø´Ù…Ø§ Ø±Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ù‚Ø·Ø¹ÛŒ Ù…Ø¹Ø±ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.' },
            { id: 'town', name: 'Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø³Ø§Ø¯Ù‡', color: '#22c55e', desc: 'Ø´Ù…Ø§ Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ù‡Ø³ØªÛŒØ¯. Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø¹Ø¯Ø§Ù… Ú©Ù†ÛŒØ¯.' },
            { id: 'town', name: 'Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø³Ø§Ø¯Ù‡', color: '#22c55e', desc: 'Ø´Ù…Ø§ Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ù‡Ø³ØªÛŒØ¯. Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø¹Ø¯Ø§Ù… Ú©Ù†ÛŒØ¯.' }
        ];
        
        var players = [];
        var currentPlayerIndex = 0;
        var jesterPlayerIndex = -1; // Index of Jester
        var icPlayerIndex = -1; // Index of Innocent Child

        // --- Logic ---
        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
        }

        function startGame() {
            // 1. Shuffle Roles
            shuffleArray(roles);
            
            // 2. Assign to Players & Find Jester/IC
            players = [];
            jesterPlayerIndex = -1;
            icPlayerIndex = -1;

            for (var i = 0; i < roles.length; i++) {
                var r = roles[i];
                if (r.id === 'jester') jesterPlayerIndex = i;
                if (r.id === 'ic') icPlayerIndex = i;
                players.push(r);
            }

            // 3. Start UI
            currentPlayerIndex = 0;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('bottom-bar').classList.add('hidden');
            showScreen('pass-screen');
            updatePassScreen();
        }

        function updatePassScreen() {
            var pNum = currentPlayerIndex + 1;
            document.getElementById('player-num-pass').innerText = pNum;
            document.getElementById('player-idx').innerText = pNum;
        }

        function revealRole() {
            var role = players[currentPlayerIndex];
            var pNum = currentPlayerIndex + 1;

            document.getElementById('player-num-reveal').innerText = pNum;

            var titleEl = document.getElementById('role-title');
            var descEl = document.getElementById('role-desc');
            var mafiaIntelEl = document.getElementById('mafia-intel');

            titleEl.innerText = role.name;
            titleEl.style.color = role.color;
            descEl.innerText = role.desc;

            // Logic: Mafia knows Jester
            if (role.id === 'mafia') {
                mafiaIntelEl.classList.remove('hidden');
                mafiaIntelEl.innerText = "ğŸ¤¡ Ø¯Ù„Ù‚Ú© Ø¨Ø§Ø²ÛŒ: Ø¨Ø§Ø²ÛŒÚ©Ù† Ø´Ù…Ø§Ø±Ù‡ " + (jesterPlayerIndex + 1);
            } else {
                mafiaIntelEl.classList.add('hidden');
            }

            // Update Next Button
            var nextBtn = document.getElementById('next-btn');
            if (currentPlayerIndex === 4) { // 5 players (0-4)
                nextBtn.innerText = "Ù¾Ø§ÛŒØ§Ù† ØªÙˆØ²ÛŒØ¹";
                nextBtn.style.backgroundColor = "#f59e0b";
            } else {
                nextBtn.innerText = "Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ùˆ Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ";
                nextBtn.style.backgroundColor = "#334155";
            }

            showScreen('reveal-screen');
        }

        function nextPlayer() {
            currentPlayerIndex++;
            if (currentPlayerIndex >= 5) {
                finishGame();
            } else {
                updatePassScreen();
                showScreen('pass-screen');
            }
        }

        function finishGame() {
            // Show IC to Moderator
            var icNum = icPlayerIndex + 1;
            document.getElementById('ic-reveal').innerText = "Ú©ÙˆØ¯Ú© Ù…Ø¹ØµÙˆÙ…: Ø¨Ø§Ø²ÛŒÚ©Ù† Ø´Ù…Ø§Ø±Ù‡ " + icNum;
            
            showScreen('end-screen');
        }

        function restartGame() {
            if (confirm("Ø¢ÛŒØ§ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ù‡Ù…Ø§Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯ØŸ")) {
                startGame();
            }
        }
        
        function newSetup() {
             document.getElementById('setup-screen').classList.remove('hidden');
             document.getElementById('bottom-bar').classList.remove('hidden');
             document.getElementById('end-screen').classList.add('hidden');
             document.getElementById('pass-screen').classList.add('hidden');
             document.getElementById('reveal-screen').classList.add('hidden');
        }

        function showScreen(id) {
            var screens = ['pass-screen', 'reveal-screen', 'end-screen'];
            for (var i = 0; i < screens.length; i++) {
                document.getElementById(screens[i]).classList.add('hidden');
            }
            document.getElementById(id).classList.remove('hidden');
        }

    </script>
</body>
</html>


